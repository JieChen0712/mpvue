<include file="Public:public"/>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>自定义菜单</title>
<link href="__PUBLIC__/css/index.css" rel="stylesheet">
<!--图标样式-->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/bootstrap.min.css">
<!--主要样式-->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/styleone.css">
<script type="text/javascript" src='__PUBLIC__/js/jquery.js'></script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-1.7.2.min.js"></script>
<style>
  .bg{background:url(__PUBLIC__/images/shouquan.jpg);background-size:450px 672px;width:450px;height:672px;margin:0 auto;position:absolute;right:130px;top:45px;}
  #bg{
      -webkit-transform: rotate(45deg);  
      -moz-transform: rotate(45deg);  
      filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
      overflow: hidden;
      z-index: 9999;
      opacity: 0.1;
      font-size: 30px;
      }
  .p1{font-size:30px;color:#df4350;font-weight:bold;position:relative;top:250px;text-align: center;}
  .p2{position: absolute;left: 116px;top: 315px;font-size: 16px;color: #03020a;width: 71px;text-align: center;font-weight: bold;}
  .test{position: absolute;left: 66px;top: 424px;font-size: 14px;color: #191820;line-height: 0px;}
  .p_img{position:relative;left: 220px;top: -117px;font-size:38px;color:#191820;}
  .p_img img{width: 80px; height: 80px;margin-top: -13px;margin-left: -13px;}
  .p3 span{font-size:12px;}
  .p4 span{font-size:12px;}
  .p5 span{font-size:12px;}
  .p6 span{font-size:12px;}
  .p7 span{font-size:12px;}
  .p8 span{font-size:12px;}
  .test hr{width:113px;border-bottom:solid 1px #000;position:relative;left:69px;margin: 10px 0;}
  .level{
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px;
    border: 1px solid #999;
    display: inline-block;
    padding: 3px 8px;
    text-decoration: none;
  }
  b{
    color:red;
    margin-left:10px;
    font-size:16px;
  }
  .level2{
    background-color: #041c42;
    color: #fff;
  }
  .level3{
    background-color: #7b1182;
    color: #fff;
  }
  .level4{
    background-color: #bac415;
    color: #fff;
  }
  .level5{
    background-color: #15bac4;
    color: #fff;
  }
  .level6{
    background-color: #20d9b0;
    color: #fff;
  }
  .tex{
    text-align: center;
  }
  .wid{
    width:20%;
  }
  .style-order{
    margin-left: 20px;
    width:850px;
    height:100px;
    overflow: auto;
  }
    /* .parent_li a{position: absolute;left: 30px;} */
</style>
<script type="text/javascript">
$(function(){
    $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
    $('.tree li.parent_li > span').live('click', function (e) {
        var children = $(this).parent('li.parent_li').find(' > ul > li');
        if (children.is(":visible")) {
            children.hide('fast');
            $(this).attr('title', 'Expand this branch').find(' > i').addClass('icon-plus-sign').removeClass('icon-minus-sign');
        }else{
            var mid = $(this).children('input').val();
            var tet = $(this).next('a').next('b').next('ul').html();
            //判断有没有把下属显示出来
            if(tet == ""){
              var texta = '';
              $.ajax({
                  async: false,
                  type : "POST",
                  data: {mid:mid},
                  dataType: "json",
                  url : '__URL__/treedirect',
                  success : function(data) {
                    if(data == 1){
                      alert("没下级代理！");
                      return;
                    }
                    //alert(data);
                    for(var i=0;i<data.length;i++){
                      texta += '<li class="parent_li"><span title="Expand this branch" class="level'+data[i]['level']+'"><input type="hidden" value="'+data[i]['id']+'"><i class="icon-plus-sign"></i>'+data[i]['name']+'</span> <a href="javascript:void(0);" onclick="xqxx('+data[i]['id']+')">详情信息</a><b>'+data[i]['count']+'</b><ul></ul></li>';
                    }
                  }
              });
              $(this).next('a').next('b').next('ul').html(texta);
            }
            children.show('fast');
            $(this).attr('title', 'Collapse this branch').find(' > i').addClass('icon-minus-sign').removeClass('icon-plus-sign');
        }
        e.stopPropagation();
    });
});
function xqxx(id){
  var textb = '';
  $.post("__URL__/persondetail",{id:id},function(data){
    textb += '<p class="p1">'+data['levname']+'</p>';
    textb += '<p class="p2">'+data['name']+'</p>';
    textb += '<div class="test">';
    textb += '<p class="p3">授权电话：<span>'+data['phone']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p4">身份证号：<span>'+data['idennum']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p5">授权代码：<span>'+data['id']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p6">授权姓名：<span>'+data['name']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p7">授权微信：<span>'+data['wechatnum']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p8">授权日期：<span>'+data['time']+'</span></p>';
    textb += '<hr>';
    textb += '<p class="p_img"><img src="'+data['headimgurl']+'" alt="" class="headimg"></p>';
    textb += '</div>';
    $('.bg').html(textb);
  },'JSON');
}
function setMenu(){
  var url = "{:U('Radmin/Menu/setWmenu')}";
  if(confirm('您确定要新微信公众号菜单？')){
      //window.location.href="{:U('Radmin/Menu/setWmenu')}";
      $.post(url,{state:1},function(data){
        if(data=="success"){
          alert("恭喜您，设置成功,请取消关注后，重新关注公众号!");
        }else{
          alert("遗憾，设置失败");
        }
      });
  }
}
</script>
</head>
<body class="zh_CN">
  <div class="col_main">
      <div class="main_hd">
          <div class="title_tab" id="topTab">
              <ul class="tab_navs mt title_tab">
                  <li class="tab_nav js_top  selected" data-id="send"> <a href="#">自定义菜单</a></li>
              </ul>
               
                  <li class="tab_nav js_top  selected" data-id="send"> <a href="javascript:window.history.go(-1);">返回</a></li>
              
          </div>
      </div>
      <section>
        <a class="btn btn-info" href="__URL__/add">添加菜单</a>　　<a class="btn btn-success" href="__URL__/index">菜单总列表</a>
        <h4 style="margin-left:20px;color:red;">微信公司规定：自定义菜单最多包括3个一级菜单，每个一级菜单最多包含5个二级菜单。</h4>
      </section>
 
    <table class="table table-bordered table-hover" style="width:850px;margin-top:20px;margin-left:20px;">
      <thead>
        <tr>
          <th style="text-align:center;" class="tex">序号</th>
          <th style="text-align:center;" class="tex">一级菜单</th>
          <th style="text-align:center;"  class="tex">二级菜单</th>
          <th style="text-align:center;" class="tex">位置</th>
          <th style="text-align:center;" class="tex">网址</th>
          <th style="text-align:center;" class="tex">操作</th>
        </tr>
      </thead>
      <volist name="list1" id="vo" key="k">
      <tr>
        <td style="text-align:center;">{$k+$start}</td>
        <td style="text-align:center;">{$vo.name}</td>
        <td style="text-align:center;">{$vo.menuname}</td>
        <td style="text-align:center;">{$vo.pos}</td>
        <td style="text-align:center;overflow:auto;">{$vo.url}</td>
        <td class="wid" style="text-align:center;">
          <a class="btn btn-default" href="__URL__/edit/id/{$vo.id}">编辑</a>
          <a class="btn btn-default" onClick="return confirm('您确定要删除？');" href="__URL__/del/id/{$vo.id}">删除</a>
        </td>
      </tr>
    </volist>
   
    </table>
      <table class="table table-bordered table-hover" style="width:850px;margin-top:20px;margin-left:20px;">
      <thead>
        <tr>
          <th style="text-align:center;" class="tex">序号</th>
          <th style="text-align:center;" class="tex">一级菜单</th>
          <th style="text-align:center;"  class="tex">二级菜单</th>
          <th style="text-align:center;" class="tex">位置</th>
          <th style="text-align:center;" class="tex">网址</th>
          <th style="text-align:center;" class="tex">操作</th>
        </tr>
      </thead>
      <volist name="list2" id="vo" key="k">
      <tr>
        <td style="text-align:center;">{$k+$start}</td>
        <td style="text-align:center;">{$vo.name}</td>
        <td style="text-align:center;">{$vo.menuname}</td>
        <td style="text-align:center;">{$vo.pos}</td>
        <td style="text-align:center;overflow:auto;">{$vo.url}</td>
        <td class="wid" style="text-align:center;">
          <a class="btn btn-default" href="__URL__/edit/id/{$vo.id}">编辑</a>
          <a class="btn btn-default" onClick="return confirm('您确定要删除？');" href="__URL__/del/id/{$vo.id}">删除</a>
        </td>
      </tr>
    </volist>
   
    </table>
         <table class="table table-bordered table-hover" style="width:850px;margin-top:20px;margin-left:20px;">
      <thead>
        <tr>
          <th style="text-align:center;" class="tex">序号</th>
          <th style="text-align:center;" class="tex">一级菜单</th>
          <th style="text-align:center;"  class="tex">二级菜单</th>
          <th style="text-align:center;" class="tex">位置</th>
          <th style="text-align:center;" class="tex">网址</th>
          <th style="text-align:center;" class="tex">操作</th>
        </tr>
      </thead>
      <volist name="list3" id="vo" key="k">
      <tr>
        <td style="text-align:center;">{$k+$start}</td>
        <td style="text-align:center;">{$vo.name}</td>
        <td style="text-align:center;">{$vo.menuname}</td>
        <td style="text-align:center;">{$vo.pos}</td>
        <td style="text-align:center;overflow:auto;">{$vo.url}</td>
        <td class="wid" style="text-align:center;">
          <a class="btn btn-default" href="__URL__/edit/id/{$vo.id}">编辑</a>
          <a class="btn btn-default" onClick="return confirm('您确定要删除？');" href="__URL__/del/id/{$vo.id}">删除</a>
        </td>
      </tr>
    </volist>
   
    </table>
    <button style="margin-left:20px;" class="btn btn-danger" onClick="setMenu();">更新当前菜单到微信公众号</button>
        <section>
        <div class="style-order">
        <h3>请注意微信公司的规定：</h3>
        <p>1、自定义菜单最多包括3个一级菜单，每个一级菜单最多包含5个二级菜单。</p>
        <p>2、一级菜单最多4个汉字，二级菜单最多7个汉字，多出来的部分将会以“...”代替。</p>
        <p>3、创建自定义菜单后，菜单的刷新策略是，在用户进入公众号会话页或公众号profile页时，如果发现上一次拉取菜单的请</p>
        <p>求在5分钟以前，就会拉取一下菜单，如果菜单有更新，就会刷新客户端的菜单。测试时可以尝试取消关注公众账号后再次</p>
        <p>关注，则可以看到创建后的效果</p>
        </div>
      </section>
	</div>
  <script>$('ul :not(:first) li').hide()</script>
</body>
</html>