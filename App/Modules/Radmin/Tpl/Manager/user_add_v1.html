<layout name="Public/public" />


<link href="__PUBLIC__/css/index.css" rel="stylesheet">
<script type="text/javascript" src="__PUBLIC__/Admin/js/agentcode.js"></script>

<script type="text/javascript" src='__PUBLIC__/Js/jquery.js'></script>
<script type="text/javascript" src='__PUBLIC__/Js/index.js'></script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-ui.js" ></script>
<link href="__PUBLIC__/Admin/css/jquery-ui.css" type="text/css" rel="stylesheet" />
<script>
    var urlxgmm = "__URL__/xgmm";
</script>

<h1 class="page-header">
    总部添加经销商
</h1>


<h3><span class="label label-info">注意后台添加的经销商无法自动登录账号，请尽量使用手机注册账号</span></h3>

<h5>
    <div class="pull-right">
        <form class="form-inline" method="post" action="__URL__/impordernumber" enctype="multipart/form-data">
        <input type="file" name="file" class="form-control" />
        </form>
    </div>
</h5>

<form class="form-inline" enctype="multipart/form-data"  method="post" action="__URL__/user_add_submit">
    <table class="table table-condensed">
        <tbody>
            <tr>
                <td>姓名：（必填）</td>
                <td>
                    <input class="form-control" name="name" value="{$vo.name}" required placeholder="请输入姓名" type="text">
                </td>
            </tr>
            <tr>
                <td>微信号：（必填）</td>
                <td>
                    <input class="form-control" name="wechatnum" value="{$vo.wechatnum}" required placeholder="请输入微信号" type="text">
                </td>
            </tr>
            <tr>
                <td>手机号：（必填）</td>
                <td>
                    <input class="form-control" name="phone" value="{$vo.phone}" required placeholder="请输入手机号" type="text">
                </td>
            </tr>
            <tr>
                <td>邮箱：（选填）</td>
                <td>
                    <input class="form-control" name="email" value="{$vo.email}" placeholder="请输入邮箱" type="text">
                </td>
            </tr>
            <tr>
                <td>身份证号：（必填）</td>
                <td>
                    <input class="form-control" name="idennum" value="{$vo.idennum}" required placeholder="请输入身份证号" type="text">
                </td>
            </tr>
            <tr>
                <td>地址：（必填）</td>
                <td>
                    <input class="form-control" name="address" value="{$vo.address}" required placeholder="请输入地址" type="text">
                </td>
            </tr>
            
            <tr>
                <td>经销商级别：</td>
                <td>
                    <select name="level" class="form-control" >
                        <option value="0">请选择经销商等级</option>
                        <foreach name="Think.config.LEVEL_NAME" key="key_left_num" item="vo_left_name">
                            <option value="{$key_left_num}">{$vo_left_name}</option>
                        </foreach>
                    </select>
                    
                    
                </td>
            </tr>
            
            <tr id="choose_dis">
                <td>经销商上级：</td>
                <td>
                    <select name="level1" id="level1" class="form-control" >
                        <option value="0">请选择经销商上级等级</option>
                        <option value="-1">总部</option>
                        <foreach name="Think.config.LEVEL_NAME" key="key_left_num" item="vo_left_name">
                            <option value="{$key_left_num}">{$vo_left_name}</option>
                        </foreach>
                    </select>
                    <select name="pid" class="mylevel1 form-control">
                        <option value="0">请选择经销商</option>
                    </select>
                    
                    <button type="button" id="search_dis_button" class="btn btn-info">搜索经销商</button>
                </td>
            </tr>
            
            <tr id="search_dis">
                <td>经销商上级：</td>
                <td>
                    <input type="text" id="agent" class="form-control" placeholder="请输入经销商姓名" onmouseup="this.select();" maxlength="80" style="width:300px;" required/>
                    <input type="hidden" id='sear_pid' name="sear_pid">
                </td>
            </tr>
            
            
            
            <tr>
                <td>头像（如不选择则显示默认头像）
                </td>
                <td>
                    <input type="file" name="image[]" id="file0"/>
                    <br><span style="color:red"></span>
                    <br><img style="width:400px;"  src="" id="img0" >
                    
                    <br />
                    默认头像：<img src="__PUBLIC__/images/headimg.png" width="10%" />
                </td>
            </tr>
            
            <if condition="$Think.config.IS_SUBMIT_ID_CARD_IMG eq 1">
            <tr>
                <td>添加身份证图片（手持身份证正面）
                </td><td>
                    <input type="file" name="image[]" id="file1"/>
                    <br><span style="color:red"></span>
                    <br><img style="width:400px;"  src="" id="img1" >
                </td>
            </tr>
            
            <tr>
                <td>添加保证金截图（限一张）
                </td><td>
                    <input type="file" name="image[]" id="file2"/>
                    <br><span style="color:red"></span>
                    <br><img style="width:400px;"  src="" id="img2" >
                </td>
            </tr>
            </if>
        
            
            
            <tr>
                <!--确定按钮-->
                <td colspan="2">
                    <input class="btn btn-primary" value="提交" type="submit">
                </td>
            </tr>

        </tbody>
    </table>
</form>

<script type="text/javascript">
    (function ($) {
        $("#file0").change(function () {
            var objUrl = getObjectURL(this.files[0]);
            console.log("objUrl = " + objUrl);
            if (objUrl) {
                $("#img0").attr("src", objUrl);
            }
        });
    })(jQuery);
    
    (function ($) {
        $("#file1").change(function () {
            var objUrl = getObjectURL(this.files[0]);
            console.log("objUrl = " + objUrl);
            if (objUrl) {
                $("#img1").attr("src", objUrl);
            }
        });
    })(jQuery);
    
    (function ($) {
        $("#file2").change(function () {
            var objUrl = getObjectURL(this.files[0]);
            console.log("objUrl = " + objUrl);
            if (objUrl) {
                $("#img2").attr("src", objUrl);
            }
        });
    })(jQuery);
    
    
    //建立一個可存取到該file的url
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }
    
    
    
    $(function () {
        $("#search_dis").hide();
    
        $("#search_dis_button").click(function(){
            $("#search_dis").show();
            $("#choose_dis").hide();
        });
        
        
        
        $("#level1").change(function () {
            var level1 = $(this).val();
            var html = '<option value="0">请选择经销商</option>';
            if (level1 == 0) {
                $(".mylevel1").html(html);
                return;
            }
            else if( level1 == '-1' ){
                html = '<option value="0">总部</option>';
                $(".mylevel1").html(html);
                return;
            }
            $.post("__APP__/Radmin/Stock/getAgent", {level: level1}, function (data) {
                if (data != 'none') {
                    var text = '';
                    $.each(data, function (index, array) {
                        text += '<option class="' + array["id"] + '" value="' + array["id"] + '">' + array["name"] + '</option>';
                    })
                    $(".mylevel1").html(text);
                } else {
                    $(".mylevel1").html(html);
                }
            })
        })
    })
        
        
    $("#agent").autocomplete({
        minLength: 1,
        autoFocus: true,
        source: function (request, response) {
            $.ajax({
                url: "__URL__/agent",
                dataType: "json",
                data: {
                    term: request.term,
                },
                success: function (data) {
                    response($.map(data, function (item) {
                        return {
//						data: item,
                            label: item.name + '---' + item.levname,
// 						value :item.agent_name,
                            ID: item.id,
//						province: item.agent_province,
//						city: item.agent_city,
                        }
                    }));
                }
            });
        },
        select: function (event, ui) {
//		$('#order_address').val(ui.item.address+item.agent_city);
            $('#sear_pid').val(ui.item.ID);
        }
    });
</script>