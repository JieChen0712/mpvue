<layout name="Public/public" />

<head>
<!--<link href="__PUBLIC__/css/index.css" rel="stylesheet">-->
<!--图标样式-->
<!--<link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/bootstrap.min.css">-->
<!--主要样式-->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/styleone.css">
 <!--<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/my/show.css">--> 
<!--<script type="text/javascript" src='__PUBLIC__/js/jquery.js'></script>-->
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-1.7.2.min.js"></script>
<style>
  .bg{background:url(__PUBLIC__/images/shouquan.jpg);background-size:450px 672px;width:450px;height:672px;margin:0 auto;position:absolute;right:130px;top:45px;}
  .bg h1{font-size:35px;color:#4abcf2;padding-top:193px;margin-left:54px;}
  .bg .test{margin-top:52px;margin-left:55px;min-width:200px;max-width: 325px;}
  .bg p{font-size:18px;line-height:29px;margin: 0 0 0px; }
  .bg hr{margin: 0px 0;}
  #bg{
      -webkit-transform: rotate(45deg);  
      -moz-transform: rotate(45deg);  
      filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
      overflow: hidden;
      z-index: 9999;
      opacity: 0.1;
      font-size: 30px;
      }
  .level{
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px;
    border: 1px solid #999;
    display: inline-block;
    padding: 3px 8px;
    text-decoration: none;
  }
  b{
    color:red;
    margin-left:10px;
    font-size:16px;
  }
  .level2{
    background-color: #041c42;
    color: #fff;
  }
  .level3{
    background-color: #7b1182;
    color: #fff;
  }
  .level4{
    background-color: #bac415;
    color: #fff;
  }
  .level5{
    background-color: #15bac4;
    color: #fff;
  }
  .level6{
    background-color: #20d9b0;
    color: #fff;
  }
    /* .parent_li a{position: absolute;left: 30px;} */
</style>
<script type="text/javascript">
$(function(){
    $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
    $('.tree li.parent_li').on('click',"span" , function (e) {
        var children = $(this).parent('li.parent_li').find(' > ul > li');
        if (children.is(":visible")) {
            children.hide('fast');
            $(this).attr('title', 'Expand this branch').find(' > i').addClass('glyphicon-plus').removeClass('glyphicon-minus');
        }else{
            var mid = $(this).children('input').val();
            var tet = $(this).next('a').next('b').next('ul').html();
            //判断有没有把下属显示出来
            if(tet == ""){
              var texta = '';
              $.ajax({
                  async: false,
                  type : "POST",
                  data: {mid:mid},
                  dataType: "json",
                  url : '__URL__/treedirect',
                  success : function(data) {
                    if(data == 1){
                      alert("没下级经销商！");
                      return;
                    }
                    //alert(data);
                    for(var i=0;i<data.length;i++){
                      texta += '<li class="parent_li"><span title="Expand this branch" class="level'+data[i]['level']
                              +'"><input type="hidden" value="'+data[i]['id']+'"><i class="glyphicon glyphicon-plus"></i>'
                              +data[i]['name']+'</span> <a href="javascript:void(0);" onclick="xqxx('+data[i]['id']
                              +')">详情信息</a><b>'+data[i]['count']+'</b><ul></ul></li>';
                    }
                  }
              });
              $(this).next('a').next('b').next('ul').html(texta);
            }
            children.show('fast');
            $(this).attr('title', 'Collapse this branch').find(' > i').addClass('glyphicon-minus').removeClass('glyphicon-plus');
        }
        e.stopPropagation();
    });
});

function xqxx(id){
  var textb = '';
  $.post("__URL__/persondetail",{id:id},function(data){
    /*textb += '<h1>'+data['levname']+'</h1>';
    textb += '<p style="margin:57px 0px 0px 102px;">'+data['name']+'</p>';
    textb += '<div class="test"><p>授&nbsp;&nbsp;权&nbsp;&nbsp;号：<span>'+data['id']+'</span></p><hr style=" margin-left:85px;width:125px;"><p>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：<span>'+data['name']+'</span></p><hr style=" margin-left:85px;width:125px;"><p>微&nbsp;&nbsp;信&nbsp;&nbsp;号：<span>'+data['wechatnum']+'</span></p><hr style=" margin-left:85px;width:125px;"><p>授权日期：<span>'+data['time']+'</span></p><hr style=" margin-left:85px;width:125px;"><img src="'+data['headimgurl']+'" alt="" class="headimg" style="width:90px;height:90px;float:right;margin-top:-95px;"></div>';*/
    textb += '<div class="agent-info" ><ul><li style="width:40px;text-align:center;"><span></span>&nbsp;'+data['name']+'</li>';
    textb += '<li style="width:90px;margin-left:42px;"><span></span>&nbsp;'+data['wechatnum']+'</li>';
    textb += '<li style="width:80%;margin-left:100px;margin-top:4px;"><span></span>'+data["levname"]+'</li>';
    textb += '<li style="width:160px;margin-left:73px;margin-top:45px;font-size:14px;border-bottom:1px solid black;"><span></span>'+data["idennum"]+'</li>';
    textb += '<li style="width:160px;margin-left:73px;margin-top:5px;font-size:14px;border-bottom:1px solid black;"><span></span>'+data["phone"]+'</li>';
    textb += '<li style="margin-top:15px;margin-left:-20px;width:160px;"><span></span><img style="width:90px;height:90px" src="'+data["headimgurl"]+'" /></li>';
    textb += '<li style="width:200px;margin-left:125px;margin-top:-48px;font-size:10px;"><span></span>'+data["start_time"]+'-'+data["end_time"]+'</li>';
    textb += '<li style="width:200px;margin-left:125px;margin-top:-35px;font-size:10px;"><span></span>'+data["authnum"]+'</li></ul>';
    // textb += '<li><span>&nbsp;'+data['idennum']+'</span></li>';
    // textb += '</ul></div><div class="my-level">'+data['levname']+'</div><div class="info">';
    // textb += '<span></span>'+data['authnum']+'</div>';       
    textb += '</div>';     
    $('.bg').html(textb);
  },'JSON');
}
</script>
<style>
  .agent-info{
      padding-top: 303px;
      margin-left: 70px;
      font-size: 10px;
      font-weight: bold;
  }
  .agent-info ul li{
    float: left;
    list-style: none;
    color: black;
  }
 .my-level{
   padding-top: 50px;
   text-align: center;
   font-size: 14px;
   color: #767676;
 }
  .info{
    padding-top: 103px;
    margin-left: 139px;
    font-size: 12px;
    font-weight: bold;
    line-height: 24px;
}
  
</style>
</head>

<h1 class="page-header">
    经销商树状图
</h1>


    <div class="main_bd">
       <div class="tree well">
        <egt name="level_num" value="1"><span class="level">{$level_name.1}</span></egt>
        <egt name="level_num" value="2"><span class="level level2">{$level_name.2}</span></egt>
        <egt name="level_num" value="3"><span class="level level3">{$level_name.3}</span></egt>
        <egt name="level_num" value="4"><span class="level level4">{$level_name.4}</span></egt>
        <egt name="level_num" value="5"><span class="level level5">{$level_name.5}</span></egt>
        <egt name="level_num" value="6"><span class="level level6">{$level_name.6}</span></egt>
          <ul>
            <volist name="row" id="vo">
            <li class="parent_li">
                <span class="level{$vo.level}" title="Expand this branch"><input type="hidden" value="{$vo.id}">
                  <i class="glyphicon glyphicon-plus"></i>{$vo.name}</span>
                  <a href="javascript:void(0);" onclick="xqxx({$vo.id})">详情信息</a>
                  <b>{$vo.count}</b>
              <ul></ul>
            </li>
            </volist>
          </ul>
        </div>
    </div>
    
    <div class="bg">
    </div>
        


<!--<script>$('ul :not(:first) li').hide()</script>-->