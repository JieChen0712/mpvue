<!DOCTYPE html>
<html lang="en">
<style type="text/css">
	table tr{
	  background: rgb(249,249,249)!important;
	}
	.layui-anim-upbit{
	  text-align: left!important;
	}
	.layui-input{
	  height: 48px;
	  box-sizing: border-box;
	}
    .layui-container .content {
         padding-bottom: 0px; 
    }

    /*小屏幕样式*/
    @media screen and (max-width: 768px) {
        .table-wrapper .change-wrapper {
            padding-bottom: 20px;
        }
        .table-wrapper .sm-td {
            text-align: left;
            margin-left: 10px;
        }
    }
</style>

<head>
    
</head>

<body>
<section class="layui-container">
        <header class="header">
            <h3>增加授权期限</h3>
        </header>
        <div class="table-wrapper">
          <form action="__URL__/add_time" class="layui-form layui-box" data-auto="false" method="post">
            <table class="layui-table" lay-skin="row" lay-size="sm">
                <tr class="change-wrapper">
                    <td class="sm-td">代理：</td>
                    <td class="sm-td"><div id='level_div' class="searchagent">
                        <select class="form-control" name="level" id="level" lay-filter="level">
                            <option value="0">全部代理</option>
                            <egt name="level_num" value="1"><option value="1">{$level_name.1}</option></egt>
                            <egt name="level_num" value="2"><option value="2">{$level_name.2}</option></egt>
                            <egt name="level_num" value="3"><option value="3">{$level_name.3}</option></egt>
                            <egt name="level_num" value="4"><option value="4">{$level_name.4}</option></egt>
                            <egt name="level_num" value="5"><option value="5">{$level_name.5}</option></egt>
                            <egt name="level_num" value="6"><option value="6">{$level_name.6}</option></egt>
                        </select>
                    </div>
                    </td>
                    <td class="sm-td">
                        <div id="mylevel_div">
                            <select class="form-control mylevel" lay-filter="agent_name" name="receive_id">
                                <option value="a">选择代理</option>
                            </select>
                        </div>
                    </td>
                    <td class="sm-td">
                        <input class="form-control" type="text" id="daili1" value="" placeholder="请输入代理名字" />
                    </td>
                    <td  class="sm-td" style="max-width:85px;">
                        <input onclick="secect_daili('daili1')" class="layui-btn layui-btn-radius layui-btn-normal" value="搜索" type="button"/>
                    </td>
                </tr>
                <tr class="change-wrapper">
                    <td  class="sm-td">授权时间：</td>
                    <td class="sm-td">
                        <input class="form-control" type="text" id="time_area" value="" disabled="disabled" />
                    </td>

                </tr>
                <tr class="change-wrapper">
                    <td class="sm-td">增加授权时间：</td>
                    <td class="sm-td"><div id='' class="searchagent">
                        <select name="end_times" id="end_times" lay-filter="plus_time" lay-verify="required" >
                            <option value="1">一个月</option>
                            <option value="2">三个月</option>
                            <option value="3">半年</option>
                            <option value="4">一年</option>
                        </select>
                    </div>
                    </td>
                </tr>
                <!--确定按钮-->
                <tr class="change-wrapper">
                    <td class="sm-td"></td>
                    <td class="layui-anim-upbit sm-td"><button class="layui-btn" lay-submit>立即提交</button></td>
                    <td class="sm-td"></td>
                    <td class="sm-td"></td>
                    <td class="sm-td"></td>
                </tr>
            </table>
            </form>
        </div>

    </div>

</section>
<script>
    $(function () {
      //监听代理等级
      form.on('select(level)',function (data) {
            var level = data.value;
            var html = '<option value="a">全部代理</option>';

            if (level == 0) {
                $(".mylevel").html(html);
                $('#mylevel_div select').find('option').val(0);
                form.render();
                return;
            }
            $.post("__APP__/Radmin/Stock/getAgent", {level: level}, function (data) {
                if (data != 'none') {
                    var text = '<option value="">选择代理</option>';
                    $.each(data, function (index, array) {
                        text += '<option class="' + array["id"] + '" value="' + array["id"] + '">' + array["name"] + '</option>';
                    })
                    $(".mylevel").html(text);
                } else {
                    $(".mylevel").html(html);
                }
                form.render()
            })
        })
    })
    //监听代理
    form.on('select(agent_name)',function(data){
      $('#time_area').val(getTime(data.value));
    })
    
    
    layui.use('form', function() {
      var form = layui.form;
    })
    form.render()
    //选择代理
    function secect_daili(js_id) {
        var name = $("#" + js_id).val();

        $.post("__GROUP__/manager/get_distributor_info", {name: name}, function (res) {
            if (res.status == 'succ') {
                change_select(js_id, res.levenames, res.data);
                $('#time_area').val(getTime(res.data[0].id));
            } else {
                layer.msg(res.msg);
            }
            form.render()
        });
    }

    //获取授权时间
    function getTime(id){
      var _timeArea = '';
      $.ajax({url:'__GROUP__/Manager/get_time_id',data:{id:id},async:false,type:'POST',success:function(data){
        if(data.code==1){
          console.log(data);
          _timeArea = data.audit_time + " 至 " + data.end_times;
        }else{
          console.log(data.msg);
        }
        }
      })
    return _timeArea;
    }


    //更改选择栏
    function change_select(js_id, levenames, data) {
        var key, level_sel_id_div, mylevel_sel_id_div,input_class;


        if (js_id == 'daili1') {
            key = '';
            level_sel_id_div = 'level_div';
            mylevel_sel_id_div = 'mylevel_div';
            input_class = 'mylevel';
        } else if( js_id == 'daili2' ) {
            key = '1';
            level_sel_id_div = 'level1_div';
            mylevel_sel_id_div = 'mylevel1_div';
            input_class = 'mylevel1';
        }
        else{
            return false;
        }

        var text1 = '';
        $.each(levenames, function (index, array) {
            text1 += '<option value=\'' + array["level"] + '\'>' + array["levname"] + '</option>';
        })
        text1 = '<select class="form-control " name="level' + key + '">' + text1 + "</select>";

        $("#" + level_sel_id_div).html(text1);


        var text2 = '';
        $.each(data, function (index, array1) {
            text2 += '<option  class='+array1["id"]+' value="' + array1["id"] + '">' + array1["name"] + '</option>';
        })
        text2 = '<select class="form-control '+input_class+'" name="receive_id' + key + '">' + text2 + "</select>";

        $("#" + mylevel_sel_id_div).html(text2);
    }

</script>
</body>

</html>