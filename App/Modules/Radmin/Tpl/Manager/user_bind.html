<layout name="Public/public" />



<h1 class="page-header">
    用户关系表
</h1>

<div class="row">
    <div class="col-md-10">
        <!--搜索表单-->
        <form class="form-inline" role="form" method="get" action="__URL__/user_bind">
            <div class="form-group">
                <label class="sr-only" for="name">经销商</label>
                <input type="text" class="form-control" name="name" id="name" placeholder="经销商">
            </div>

            <button type="submit" class="btn btn-default">搜索</button>
        </form>
        <!--end 搜索表单-->
    </div>

    <div class="col-md-2">
<!--        <button type="button" onclick="location.href = '__URL__/expUser?pd=manager&level={$level}'" class="btn btn-info">导出Excel</button>-->
    </div>
</div>



<!--表格-->
<table class="table table-condensed table-hover table-responsive table-bordered">
    <thead>
        <tr>
            <th>序号</th>
            <th>经销商名称</th>
            <th>经销商等级</th>
            <th>上级名称</th>
            <th>上级等级</th>
            <foreach name="Think.config.LEVEL_NAME" key="key_left_num" item="vo_left_name">
                <th>{$vo_left_name}</th>
            </foreach>
            <th>修改时间</th>
        </tr>
    </thead>
    <tbody>
    <empty name="list">
        <tr><td colspan="16">对不起,没有找到经销商! </td></tr>
        <else />
        <volist name="list" id="m">
            <tr>
                <td>{$m.id}</td>
                <td>{$m.u_name}</td>
                <td>{$m.u_levname}</td>
                <td>{$m.p_name}</td>
                <td>{$m.p_levname}</td>
                <foreach name="Think.config.LEVEL_NAME" key="key_left_num" item="vo_left_name">
                    <php>$level_key = 'level'.$key_left_num.'_name';</php>
                    <td>{$m.$level_key}</td>
                </foreach>
                <td>{$m.updated_format}</td>
            </tr>
        </volist>
        <tr><td colspan="16"><div class="pull-right">{$page}</div></td></tr>
    </empty>
</tbody>
</table>
<!--end 表格-->


<script>

    //----升级经销商-------

    function change_dis_div(id, level, name, type) {

        if (level == 1 && type == 'up') {
            alert('最高级别无法升级！');
            return;
        }
        if (level == level_num && type == 'down') {
            alert('最低级别无法降级！');
            return;
        }


        //赋值
        var name_str = '<b>' + name + '</b>';
        $("#dis_upgrade_name").html(name_str);
        $("#dis_upgrade_mid").val(id);
        //$("#dis_upgrade_b_name").val(name);

        //弹出框标题
        var dis_upgrade_title = ''
        if (type == 'up') {
            dis_upgrade_title = '升级处理';
            $("#dis_upgrade_type").val('up');
        } else {
            dis_upgrade_title = '降级处理';
            $("#dis_upgrade_type").val('down');
        }

        $("#dis_upgrade_title").html(dis_upgrade_title);

        //级别选择框
        var type_level;
        if (type == 'up') {
            type_level = Number(level) - 1;
            $(".dis_upgrade_dis_info_select_up").show();
            $(".dis_upgrade_dis_info_select_down").hide();
            
            $("#dis_upgrade_dis_info_select1").val(type_level);
            $("#dis_upgrade_dis_info_select").val('-1');
        } else {
            type_level = Number(level) + 1;
            $(".dis_upgrade_dis_info_select_up").hide();
            $(".dis_upgrade_dis_info_select_down").show();
            
            $("#dis_upgrade_dis_info_select1").val(type_level);
            $("#dis_upgrade_dis_info_select").val('-1');
        }

        //上级经销商
        get_dis_info();

        $('.dis_upgrade').modal('show');
    }
    

    function get_select_val(js_id) {
//        var b_id = $("#"+js_id).val();
//        alert($("#"+js_id).val());
//        $("#dis_upgrade_b_id").val(b_id);
    }


    function get_dis_info() {
        level = $("#dis_upgrade_dis_info_select").val();

        $(".dis_upgrade_dis_info_parent_option").hide();

        //如果已经有该级别经销商信息，直接显示
        if ($(".dis_upgrade_dis_info_parent_" + level).length > 0) {
            $(".dis_upgrade_dis_info_parent_" + level).show();
            return;
        }
        else if( level == -1 ){
            return;
        }

        $.post("__APP__/Radmin/Stock/getAgent", {level: level}, function (data) {
            var text = '';

            if (data != 'none') {
                $.each(data, function (index, array) {
                    text += '<option class="dis_upgrade_dis_info_parent_option dis_upgrade_dis_info_parent_' + level + '" value="' + array["id"] + '">' + array["name"] + '</option>';
                })
            } else {
                text += '<option class="dis_upgrade_dis_info_parent_option dis_upgrade_dis_info_parent_' + level + '" value="">无经销商信息</option>';
            }

            $("#dis_upgrade_dis_info_parent").append(text);
//            $(text).appendTo("#dis_upgrade_dis_info_parent");
        })
    }
    //----end 升级经销商-------


    //--------招募经销商----------

    function change_dis_statu(id,statu) {
        
        var alert_msg = '确认允许该经销商招募经销商吗？';
        if( statu==1 ){
            alert_msg = '确认禁止该经销商招募经销商吗？';
        }
        
        if( !confirm(alert_msg) ){
            return false;
        }
        
        $.ajax({
            async: false,
            type: "POST",
            data: {id: id, statu: statu},
            dataType: "json",
            url: '__URL__/zstatu',
            success: function (ree) {
                
            }
        });
        
        return true;
    }

    function change_dis_disable(id,disable) {
        var alert_msg = '确认允许该经销商使用吗？';
        if( disable==1 ){
            alert_msg = '确认禁止该经销商使用吗？';
        }
        
        if( !confirm(alert_msg) ){
            return false;
        }
        
        $.ajax({
            async: false,
            type: "POST",
            data: {id: id, statu: disable},
            dataType: "json",
            url: '__URL__/disable',
            success: function (ree) {
            }
        });
        
        return true;
    }

    //--------end 招募经销商----------


</script>
