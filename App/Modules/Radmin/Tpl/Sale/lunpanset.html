<layout name="Public/public" />
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--<link rel="stylesheet" href="__PUBLIC__/sale_v1/css/reset.css">-->
    <link rel="stylesheet" href="__PUBLIC__/sale_v1/css/lunpanset.css">
    <link rel="stylesheet" href="__PUBLIC__/sale_v1/css/fileinput.css">
    <title>轮盘抽奖设置</title>
    <script>
    	var lunpanset_addurl = '__URL__/lunpanset_ajax';
    	var lunpanset_delurl = '__URL__/lunpanset_del_ajax';
    </script>
</head>
<body>
  <header id="header" class="containers">
    <h1 class="lp-title">轮盘抽奖设置</h1>
  </header>
  <section id="main" class="containers">
     <ul class="nav nav-tabs nav-reset">
                    <li >
                        <a href="__GROUP__/sale/lunpanbase">基础设置</a>
                    </li>
                    <li class="active">
                        <a href="__GROUP__/sale/lunpanset">奖品设置</a>
                    </li>
                </ul>
      
      <form class="form-inline" method="post" action="__URL__/lunpanset_post" enctype="multipart/form-data">
    <div class="prize-wrapper row">
    	<div class="prize-explain col-md-12">
    		<!--<p class="explain-p">注意事项：例如原来是5个奖品，再选择为3个</p>-->
    	</div>
      <div class="prize-count">
        <p class="col-md-2">添加奖项</p>
        
        <input type="button" class="btn btn-success" name="prize-add" id="prize-add" value="添加" /><br />
        
        <input type='hidden' value="{$count}" id='lunpancount' />
      </div>
      
    <div id="prize_content">
        
    </div>
      
    </div>
  </section>
   </form>
   <section id="form-all">
       
       <?php foreach( $list as $v ):?>
       <form method="post" action="__URL__/lunpanset_post" onsubmit="return saveReport();" enctype="multipart/form-data" >
		<div id="prize_content_hidden" >
			<div class="prize">
				<p class="col-md-2">奖品名:</p>
                                <p class="col-md-9"><input id="name{$v.id}" name="name" id="prize-name" required type="text" placeholder="奖品名" value="{$v['name']}" ></p>
			</div>
			<div class="probability">
				<p class="col-md-2">中奖概率：</p>
				<p class="col-md-9"><input id="percent{$v.id}" name="percent" id="prize-pecent" required type="text" placeholder="百分比" value="{$v['percent']}">‰</p>
			</div>
			<div class="prize-num">
				<p class="col-md-2">奖品数量：</p>
				<p class="col-md-9">
                                    <input id="total_num{$v.id}" name="total_num" id="prize-size" required type="number" placeholder="数量" value="{$v['total_num']}">
                                {$v['send_num']}/{$v['total_num']}
                                </p>
			</div>
                    
                        <div class="prize-num">
				<p class="col-md-2">运费金额：</p>
				<p class="col-md-9"><input name="money" id="prize-size" required type="text" placeholder="运费金额" value="{$v['money']}"></p>
			</div>
			
                    
			<div class="prize-img">
				<p class="col-md-2" class="prize-title">奖品图片：<br />
                                    <?php if( !empty($v['img']) ):?>
                                    <!--<a target="__black" href="{$v['img']}">显示已提交图片</a>-->
                                    <?php endif?>
                                </p>
                                
                                <!--<input class="file" required id="img{$v.id}" name="img" type="file" multiple data-min-file-count="0">-->    
                                <input type="hidden" name="old_image" value="{$v.img}">
                                <input type="file" name="image" onchange="return img_change(this);"  />
                                <img style="width:80px;height:80px;margin-left:105px;"  src="{$v.img}" >
                                
			</div>
			<section id="button" class="prize-submit col-md-12">
                                <input type="hidden" name="id" id="id{$v.id}" value="{$v['id']}" />
                                
                                <!--onclick="return submitform('{$i}');"-->
                                <button type="submit"  class="save btn btn-success">提交</button>
                                <input type="button" onclick="return deleteform('{$v.id}');" name="delete-form" class="delete-form btn btn-danger" value="删除" />
				<!--<button class="clear btn btn-danger delete-form">删除</button>-->
			</section>
		</div>
	</form>
       <?php endforeach;?>
       
   </section>
   
      
      <div id='new_form' class="hidden">
      <form class="" method="post" action="__URL__/lunpanset_post" onsubmit="return saveReport();" enctype="multipart/form-data" >
		<div id="prize_content_hidden" >
			<div class="prize">
				<p class="col-md-2">奖品名:</p>
                                <p class="col-md-9"><input name="name" id="prize-name" required type="text" placeholder="奖品名" value="" ></p>
			</div>
			<div class="probability">
				<p class="col-md-2">中奖概率：</p>
				<p class="col-md-9"><input name="percent" id="prize-pecent" required type="text" placeholder="百分比" value="">‰</p>
			</div>
			<div class="prize-num">
				<p class="col-md-2">奖品数量：</p>
				<p class="col-md-9"><input name="total_num" id="prize-size" required type="number" placeholder="数量" value=""></p>
			</div>
                    
                        <div class="prize-num">
				<p class="col-md-2">运费金额：</p>
				<p class="col-md-9"><input name="money" id="prize-size" required type="text" placeholder="运费金额" value=""></p>
			</div>
			
                    
			<div class="prize-img">
				<p class="col-md-2" class="prize-title">奖品图片：<br />
                                    PS：建议是50*50大小，透明背景的图片
                                </p>
                                
                                <!--<input class="file" required  name="img" type="file" multiple data-min-file-count="0">-->
                                <input type="file" name="image" onchange="return img_change(this);"  />
                                <img style="width:80px;height:80px;margin-left:105px;"  src="" >
			</div>
			<section id="button" class="prize-submit col-md-12">
                                <input type="hidden" name="id"  value="" />
                                
                                <!--onclick="return submitform('{$i}');"-->
                                
                                <button type="submit"  class="save btn btn-success">提交</button>
                                
                                <!--<input type="button" onclick="return deleteform();" name="delete-form" class="delete-form btn btn-danger" value="删除" />-->
				<!--<button class="clear btn btn-danger delete-form">删除</button>-->
			</section>
		</div>
	</form>
    </div>
      
      
  <script src="__PUBLIC__/sale_v1/js/jquery.js"></script>
  <script src="__PUBLIC__/sale_v1/js/bootstrap.min.js"></script>
  <script src="__PUBLIC__/sale_v1/js/fileinput.js"></script>
  <script src="__PUBLIC__/sale_v1/js/lunpanset.js"></script>
  <script type="text/javascript">


function img_change(obj){
        
     var  parent_obj = $(obj).parents();
     var img = $(parent_obj).children('img');
//     console.log(img);
     
     var objUrl = getObjectURL(obj.files[0]) ;
        console.log("objUrl = "+objUrl) ;
        if (objUrl) {
                $(img).attr("src", objUrl) ;
        }
 }

//建立一個可存取到該file的url
function getObjectURL(file) {
	var url = null ; 
	if (window.createObjectURL!=undefined) { // basic
		url = window.createObjectURL(file) ;
	} else if (window.URL!=undefined) { // mozilla(firefox)
		url = window.URL.createObjectURL(file) ;
	} else if (window.webkitURL!=undefined) { // webkit or chrome
		url = window.webkitURL.createObjectURL(file) ;
	}
	return url ;
}
</script>
</body>
</html>