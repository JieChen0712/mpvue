<include file="Public:public"/>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>编辑系统出库</title>
<link href="__PUBLIC__/Admin/css/jquery-ui.css" type="text/css" rel="stylesheet" />
<link href="__PUBLIC__/css/index.css" rel="stylesheet">
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/js/jquery-ui.js" ></script>
<script type="text/javascript">

function deleteitem(ob){
	ob.parentNode.parentNode.removeChild(ob.parentNode);
}

$(document).ready(function(){
	
	$("#m_url").keydown(function(event){ 
		if(event.which == 13){
			getPtag();
		}
	});
	$("#del").click(function(){
		this.remove();
	});
	
	$("#form_submit").click(function(){
		var searchagent = $('.mylevel').val();
		var agent = $("input[name=receive_id]").val();
		if(searchagent == 0){
			if(agent == ""){
				alert('收货代理不能为空！');
				return false;
			}
			
		}else{
			$("input[name=receive_id]").val(searchagent);
		} 
		$("#proform").submit();
	});
}); 

function getPtag(){ 
	var m_url = $("#m_url").val();
	if(m_url){
		$.ajax({ 
			type: "post", 
			url : "__APP__/Radmin/Stock/bigPtag",
			dataType:'json',
			data: 'm_url='+m_url,
			success: function(json){
				//alert(json.username+'\n'+json.password); //把php中的返回值（json.username）给 alert出来 
				if(json != null){
					var m_html = "";
					m_html = "<div><input type='text' readonly name='pbeg[]' value='"+json.ptag_beg+"' />~<input type='text' readonly name='pend[]' value='"+json.ptag_end+"'/>（共<b id='pronum'>"+json.ptag_total+"</b>件）<input type='hidden' value='"+json.ptag_total+"' name='product_num[]'/><input type='hidden' value='"+json.ptag_name+"' name='ptag_name[]'/><input onclick='deleteitem(this)' type='button' value='删除'/></div>";
					$('#addtag').append(m_html);
					$("#m_url").val('');
					$('#urlTip').html("");
				}else{
					$('#urlTip').html("<font color='red'>标签不存在</font>");
				}
			}
		}); 
	}else{
		$('#urlTip').html("");
	}
}
</script>

<script>
$(function(){
	$("#level").change(function(){
		var level = $(this).val();
		var html = '<option value="0">请选择代理</option>';
		if(level == 0){
			$(".mylevel").html(html);
			return;
		}
		$.post("__APP__/Radmin/Stock/getAgent",{level:level},function(data){
			if(data != 'none'){
				var text = '';
				$.each(data,function(index,array){
					text +='<option value="'+array["id"]+'">'+array["name"]+'</option>';
				})
				$(".mylevel").html(text);
			}else{
				$(".mylevel").html(html);
			}
		})
	})
})
</script>
<script type="text/javascript">
	function search(){
		$(".searchagent").hide();
		$(".searchagent").remove();
		$(".mysearch").show();
		$(".search").hide();
	}
</script>
</head>
<body class="zh_CN">
          <div class="col_main">
		<div class="main_hd">
			<div class="title_tab" id="topTab">
				<ul class="tab_navs mt title_tab">
                   	<li class="tab_nav js_top  selected" data-id="send"><a href="#">编辑系统出库</a></li>
                 	</ul>
               </div>
               
               <div class="menu">
				
				
			</div>
	
		</div>
		<!--右边内容--> 
		<div class="main_bd">
				<form method="post" action="__URL__/update" id="proform">
		            <table style="margin-left:0px;text-align:left;width:900px;">
		             <tbody>
		            <!-- 获取数据 -->
	              	<tr>
	              		<td>获取数据：</td>
	              		<td>
	              			<!-- value="http://szzao.com/c/?tab&tag" -->
		              		<input type="text" name="m_url" id="m_url" style="width:300px;"/>
		              		<input type="hidden" name="checkUrl" id="checkUrl">
		              		<span id="urlTip"></span>
	              		</td>
	              	</tr>
	              	<!-- 收件人 -->
	              	<tr>
		              	<td>收货代理：</td>
		              	<td><div class="searchagent">
		              		<select name="level" id="level">
		              			<option value="0">请选择代理等级</option>
		              			<egt name="level_num" value="1"><option value="1">{$level_name.1}</option></egt>
		              			<egt name="level_num" value="2"><option value="2">{$level_name.2}</option></egt>
		              			<egt name="level_num" value="3"><option value="3">{$level_name.3}</option></egt>
		              			<egt name="level_num" value="4"><option value="4">{$level_name.4}</option></egt>
		              			<egt name="level_num" value="5"><option value="5">{$level_name.5}</option></egt>
		              			<egt name="level_num" value="6"><option value="6">{$level_name.6}</option></egt>
		              		</select>
		              		<select name="receive_id" class="mylevel">
		              		<option value="0">请选择代理</option>
		              		</select>
		              		</div>
							<div class="mysearch" style="display:none">
		              		<input type="text" id="agent" placeholder="请输入代理姓名" onmouseup="this.select();" maxlength="80" style="width:300px;" required/>
		              		<input type="hidden" id='receive_id' name="receive_id">
		              		</div>

		              	</td>
	              	</tr>
	              	<!-- 模板名 -->
	              	<tr>
	              	<td>选择模板：</td>
		              	<td>
		              		<select name="templet_id">
		              	    <volist name="templet" id="t">
		              	    	<option value="{$t.id}">{$t.name}</option>
		              	    </volist>
		              	    </select>
			             	<input type="text" style="display:none" placeholder="默认不用选择" onmouseup="this.select();" maxlength="80" style="width:300px;"/>
			            </td>
	              	</tr>
	              	<!-- 首尾标签 -->
	              	<tr>
		              	<td>首末标签：</td>
		              	<td id="addtag"></td>
	              	</tr>
	              	
	              	
	              	<!--确定按钮-->
					<tr>
						<td></td>
						<td>
			              	<input id="form_submit" class="btn1" value="提交" type="button"/>
		              	</td>
		              	<td>
		              		<input type="hidden" name="id" value="{$id}"/>
		              	</td>
	              	</tr>
		            	</tbody>
		            </table>
				</form>
				<button class="search" value="" onclick="search();" style="margin-left: 450px;margin-top: -106px;">搜索代理
				</button>
			</div>
		              		
	</div>
	

<script type="text/javascript">
$("#agent").autocomplete({
	minLength:1,
	autoFocus:true, 
	source: function(request, response){
		$.ajax({
			url: "__APP__/Radmin/Stock/agent", 
			dataType: "json",
			data: {
				term: request.term,
			},
			success: function(data){
				response($.map(data,function(item){
					return {
//						data: item,
						label :item.name+'---'+item.levname,
// 						value :item.agent_name,
						ID: item.id,
//						province: item.agent_province,
//						city: item.agent_city,
					}
				}));
			} 
		}); 
	},
	select: function(event, ui){
//		$('#order_address').val(ui.item.address+item.agent_city);
		$('#receive_id').val(ui.item.ID);
	}
});

$("#templet").autocomplete({
	minLength:1,
	autoFocus:true, 
	source: function(request, response){
		$.ajax({
			url: "__APP__/Radmin/Stock/templet", 
			dataType: "json",
			data: {
				term: request.term,
			},
			success: function(data){
				response($.map(data,function(item){
					return {
						data: item,
						label :item.name,
						ID: item.id,
					}
				})); 
			} 
		}); 
	},
	select: function(event, ui){
		$('#templet_id').val(ui.item.ID);
	}
});
</script>

</body>
</html>