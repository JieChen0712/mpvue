<html>

<head>
  <title>添加运费模板</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <style type="text/css">
    .layui-input-block {
      margin-left: 0;
    }

    .layui-form-checkbox i {
      transform: translateY(50%);
    }

    .checkbox-wrapper {
      flex: 0 0 115px;
      height: 33px;
    }

    .hide_body .layui-icon {
      transform: none;
    }

    .area_wrapper {
      line-height: 30px;
      margin-bottom: 20px;
      overflow: hidden;
      display: flex;
    }

    .child_area {
      flex: 1;
    }
  </style>
</head>

<body>
<div class="container-fluid edit-wrapper layui-container">
  <header class="edit-title">
    <blockquote class="layui-elem-quote">
      <span class="title">添加运费模板</span>
    </blockquote>
  </header>
  <div class="layui-content">
    <form class="layui-form layui-box" action="__URL__/insert" data-auto="false" method="post" enctype="multipart/form-data">
      <div class="layui-form-item items">
        <label class="form-text">模板名称：</label>
        <div class="form-right">
          <input class="input-inf2 dfinput" required="" type="text" name="template_name" lay-verify="name" autocomplete="off" title="请输入模板名称" placeholder="请输入模板名称">
        </div>
      </div>
      <!--<div class="layui-form-item  items">-->
        <!--<label class="form-text">宝贝地址：</label>-->
        <!--<div class="form-right">-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<select name="country" id="selCountries" lay-filter="selCountries" class="ddcg_select fc_66" name="country" lay-verify="required" lay-filter="level_one">-->
              <!--<option value="0">请选择国家</option>-->
              <!--<volist name="countrylist" id="country">-->
                <!--<option value="{$country.region_id}">{$country.region_name}</option>-->
              <!--</volist>-->
            <!--</select>-->
          <!--</div>-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<select  lay-filter="selProvinces" name="province" id="selProvinces" lay-verify="required" lay-filter="level_two">-->
              <!--<option value="a">请选择</option>-->
            <!--</select>-->
          <!--</div>-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<select  lay-filter="selCities" name="city" id="selCities" lay-verify="required" lay-filter="level_three">-->
              <!--<option value="a">请选择</option>-->
            <!--</select>-->
          <!--</div>-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<select lay-filter="selDistricts" id="selDistricts" name="area" lay-verify="required" lay-filter="level_three">-->
              <!--<option value="a">请选择</option>-->
            <!--</select>-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
      <!--<div class="layui-form-item  items">-->
        <!--<label class="form-text">是否包邮：</label>-->
        <!--<div class="form-right">-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<input type="radio" name="is_free" id="is_free0" value="自定义运费" lay-filter="diyPostage" title="自定义运费" checked="checked">-->
          <!--</div>-->
          <!--<div class="layui-input-inline three-select">-->
            <!--<input type="radio" name="is_free" id="is_free1" value="买家承担运费" lay-filter="postage" title="买家承担运费">-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
      <div class="layui-form-item  items">
        <label class="form-text">计费方式：</label>
        <div class="form-right">
          <div class="layui-input-inline three-select">
            <input type="radio" name="price_way" value="1" id="price_way0" lay-filter="payWay" title="按件数" checked="checked">
          </div>
          <div class="layui-input-inline three-select">
            <input type="radio" name="price_way" value="2" id="price_way1" lay-filter="payWay" title="按重量">
          </div>
          <div class="layui-input-inline three-select">
            <input type="radio" name="price_way" value="3" id="price_way2" lay-filter="payWay" title="按体积">
          </div>
        </div>
      </div>
      <div class="layui-form-item items" style="z-index:9999;">
        <label class="form-text">运费减免：</label>
        <div class="form-right">
          <div class="layui-input-inline three-select">
            <select name="reduce_id">
              <option value="">请选择</option>
              <volist name="shipping_reduce" id="m">
                <option value="{$m.id}">{$m.name}</option>
              </volist>
            </select>
          </div>
        </div>
      </div>
      <div class="layui-form-item  items">
        <label class="form-text">运费方式：</label>
        <div class="form-right" id="payways">
          <div class="layui-input-block">
            <input type="checkbox" name="shipping_way[]" value="0" price_way="1" id="kuaidi" lay-skin="primary" lay-filter="kuaidi" title="快递">
          </div>
          <div id="jifeifangshi_kuaidi"></div>
          <!--<div class="layui-input-block">-->
            <!--<input type="checkbox" name="shipping_way[]" value="1" price_way="1" id="ems" lay-skin="primary" lay-filter="ems" title="EMS">-->
          <!--</div>-->
          <!--<div id="jifeifangshi_ems"></div>-->
          <!--<div class="layui-input-block">-->
            <!--<input type="checkbox" name="shipping_way[]" value="2" price_way="1" id="pingyou" lay-skin="primary" lay-filter="pingyou" title="平邮">-->
          <!--</div>-->
          <!--<div id="jifeifangshi_pingyou"></div>-->
        </div>
      </div>
      <div class="layui-form-item  items">
        <label class="form-text"></label>
        <div class="form-right">
          <button class="layui-btn" lay-submit="" lay-filter="*">保存并返回</button>
        </div>
      </div>

      <div id="myModal2" class="modal" data-easein="fadeInRight" data-easeout="fadeOutRight" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="top: 20%" ;>
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title">选择运送地区</h4>
            </div>
            <div class="modal-body">
              <div class="hide_body">
              </div>

            </div>
            <div class="modal-footer">
              <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</button>
              <button class="btn btn-primary" onclick="closeDiv()" data-dismiss="modal" aria-hidden="true">确认</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<script type="text/javascript">
    form.render();

    var checkid = 0;

    var kuaidi_anjian_table = '<table class="table" id="table">' +
        '<tr>' +
        '<th width="200">运送到</th>' +
        '<th width="70">首件（个）</th>' +
        '<th width="70">首费（元）</th>' +
        '<th width="70">续件（个）</th>' +
        '<th width="70">续费（元）</th>' +
        '<th width="50">操作</th>' +
        '</tr>' +
        '</table>';
    var kuaidi_anzhong_table = '<table class="table">' +
        '<tr>' +
        '<th width="200">运送到</th>' +
        '<th width="70">首重（kg）</th>' +
        '<th width="70">首费（元）</th>' +
        '<th width="70">续重（kg）</th>' +
        '<th width="70">续费（元）</th>' +
        '<th width="50">操作</th>' +
        '</tr>' +
        '<tr>' +
        '<td style="text-algin:right;">' +
        '<div class="area-group">' +
        '<p id="a">未指定区域</p>' +
        '</div>' +
        '<a href="#myModal2" class="link area-edit" data-toggle="modal" onclick="fn(this)">编辑</a>' +
        '<input id="aname" name="other[0][area_name]" type="hidden" value="">' +
        '<input type="hidden" id="aid" name="other[0][area_id]" value="" >' +
        '</td>' +
        '<td>' +
        '<input class="flw" type="hidden" name="other[0][shipping_way]" value="0"/>' +
        '<input type="text" name="other[0][first_num]" value="1" class="input-text">' +
        '</td>' +
        '<td><input type="text" name="other[0][first_fee]" value="1" class="input-text"></td>' +
        '<td><input type="text" name="other[0][continue_num]" value="1" class="input-text"></td>' +
        '<td><input type="text" name="other[0][continue_fee]" value="1" class="input-text"></td>' +
        '<td><a class="link" onclick="removeDiv(this)">删除</a></td>' +
        '</tr>' +
        '</table>';
    var kuaidi_antiji_table = '<table class="table">' +
        '<tr>' +
        '<th width="200">运送到</th>' +
        '<th width="70">首体积（m³）</th>' +
        '<th width="70">首费（元）</th>' +
        '<th width="70">续体积（m³）</th>' +
        '<th width="70">续费（元）</th>' +
        '<th width="50">操作</th>' +
        '</tr>' +
        '<tr>' +
        '<td style="text-algin:right;">' +
        '<div class="area-group">' +
        '<p id="a">未指定区域</p>' +
        '</div>' +
        '<a href="#myModal2" class="link area-edit" data-toggle="modal" onclick="fn(this)">编辑</a>' +
        '<input id="aname" name="other[0][area_name]" type="hidden" value="">' +
        '<input type="hidden" id="aid" name="other[0][area_id]" value="" >' +
        '</td>' +
        '<td>' +
        '<input class="flw" type="hidden" name="other[0][shipping_way]" value="0"/>' +
        '<input type="text" name="other[0][first_num]" value="1" class="input-text">' +
        '</td>' +
        '<td><input type="text" name="other[0][first_fee]" value="1" class="input-text"></td>' +
        '<td><input type="text" name="other[0][continue_num]" value="1" class="input-text"></td>' +
        '<td><input type="text" name="other[0][continue_fee]" value="1" class="input-text"></td>' +
        '<td><a class="link" onclick="removeDiv(this)">删除</a></td>' +
        '</tr>' +
        '</table>';
    var b = 0;

    function addShipping(_this) {
//      console.log(_this)
        var id = $(_this).attr("id");
        if(_this.checked) {
            b++;
            var kuaidi_anjian = '<div id="kuaidishow">' +
                '<span class="default1 fl">默认运费：</span>' +
                '<input class="flw" type="hidden" name="default[' + b + '][shipping_way]" value="0"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][area_id]" value="1"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][is_default]" value="1"/>' +
                '<input class="flw" type="text" name="default[' + b + '][first_num]" value="1"/>' +
                '<span class="fl">件内</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][first_fee]"  value="1"/>' +
                '<span class="fl">元，每增加：</span>' +
                '<input class="flw" type="text" name="default[' + b + '][continue_num]" value="1"/>' +
                '<span class="fl">件，增加运费:</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][continue_fee]"  value="1"/>' +
                '<span class="fl">元</span>' +
                '</div>' +
                '<p>&nbsp;</p>' +
                '<span style="margin-left:60px;" ><a class="link" price_way="1" onclick="add_table(this)" >为指定地区设置运费</a></span>';

            var kuaidi_anzhong = '<div id="kuaidishow" >' +
                '<span class="default1 fl">默认运费：</span>' +
                '<input class="flw" type="hidden" name="default[' + b + '][shipping_way]" value="1"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][area_id]" value="1"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][is_default]" value="1"/>' +
                '<input class="flw" type="text" name="default[' + b + '][first_num]" value="1"/>' +
                '<span class="fl">kg内</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][first_fee]"  value="1"/>' +
                '<span class="fl">元，每增加：</span>' +
                '<input class="flw" type="text" name="default[' + b + '][continue_num]" value="1"/>' +
                '<span class="fl">kg，增加运费:</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][continue_fee]"  value="1"/>' +
                '<span class="fl">元</span>' +
                '</div>' +
                '<p>&nbsp;</p>' +
                '<span id="kuaidispan" style="margin-left:60px;" ><a class="link" price_way="2" onclick="add_table(this)" >为指定地区设置运费</a></span>';;
            var kuaidi_antiji = '<div id="kuaidishow" >' +
                '<span class="default1 fl">默认运费：</span>' +
                '<input class="flw" type="hidden" name="default[' + b + '][shipping_way]" value="2"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][area_id]" value="1"/>' +
                '<input class="flw" type="hidden" name="default[' + b + '][is_default]" value="1"/>' +
                '<input class="flw" type="text" name="default[' + b + '][first_num]" value="1"/>' +
                '<span class="fl">㎥内</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][first_fee]"  value="1"/>' +
                '<span class="fl">元，每增加：</span>' +
                '<input class="flw" type="text" name="default[' + b + '][continue_num]" value="1"/>' +
                '<span class="fl">㎥，增加运费:</span>' +
                '<input class="flw" type="text"  name="default[' + b + '][continue_fee]"  value="1"/>' +
                '<span class="fl">元</span>' +
                '</div>' +
                '<p>&nbsp;</p>' +
                '<span id="kuaidispan" style="margin-left:60px;" ><a class="link" price_way="3" onclick="add_table(this)" >为指定地区设置运费</a></span>';

            $("#jifeifangshi_" + id).show();
            var price_way = $(_this).attr("price_way");
            if(id == "kuaidi") {
                if(price_way == 1) {
                    $("#jifeifangshi_kuaidi").html(kuaidi_anjian);
                }
                if(price_way == 2) {
                    $("#jifeifangshi_kuaidi").html(kuaidi_anzhong);
                }
                if(price_way == 3) {
                    $("#jifeifangshi_kuaidi").html(kuaidi_antiji);
                }
                $("#jifeifangshi_kuaidi").find(".link").attr("shipping_way", "0");
                $("#jifeifangshi_kuaidi").find("input[name$='][shipping_way]']").val(0);
            }
            if(id == "ems") {
                if(price_way == 1) {
                    $("#jifeifangshi_ems").html(kuaidi_anjian);
                }
                if(price_way == 2) {
                    $("#jifeifangshi_ems").html(kuaidi_anzhong);
                }
                if(price_way == 3) {
                    $("#jifeifangshi_ems").html(kuaidi_antiji);
                }
                $("#jifeifangshi_ems").find(".link").attr("shipping_way", "1");
                $("#jifeifangshi_ems").find("input[name$='][shipping_way]']").val(1);
            }
            if(id == "pingyou") {
                if(price_way == 1) {
                    $("#jifeifangshi_pingyou").html(kuaidi_anjian);
                }
                if(price_way == 2) {
                    $("#jifeifangshi_pingyou").html(kuaidi_anzhong);
                }
                if(price_way == 3) {
                    $("#jifeifangshi_pingyou").html(kuaidi_antiji);
                }
                $("#jifeifangshi_pingyou").find(".link").attr("shipping_way", "2");
                $("#jifeifangshi_pingyou").find("input[name$='][shipping_way]']").val(2);
            }
        } else {
            $("#jifeifangshi_" + id).hide();
        }
    }

    //    $(":radio[name='price_way']").change(function() {
    //      if(this.checked == true) {
    //        if(confirm('切换计价方式后，所设置当前模板的运输信息将被清空，确定继续吗？')) {
    //          $(":checkbox[name='shipping_way[]']").attr("price_way", $(this).val()).attr("checked",
    //            false);
    //          $("#jifeifangshi_pingyou").empty();
    //          $("#jifeifangshi_ems").empty();
    //          $("#jifeifangshi_kuaidi").empty();
    //        }
    //      }
    //    })

    function add_table(event) {
        var price_way = $(event).attr("price_way");
        $p = $(event).parent().parent().find("p").eq(0);
        if(price_way == 1) {
            $p.after(kuaidi_anjian_table);
            add_tr(event);
        }
        if(price_way == 2) {
            $p.after(kuaidi_anzhong_table);
        }
        if(price_way == 3) {
            $p.after(kuaidi_antiji_table);
        }
        $(event).attr("onclick", "add_tr(this)");
    }

    function add_tr(data) {
        b++;
        var shipping_way = $(data).attr("shipping_way");
        var kuaidi_anjian_tr = '<tr>' +
            '<td style="text-algin:right;">' +
            '<div class="area-group">' +
            '<p id="a' + b + '">未指定区域</p>' +
            '<input id="a' + b + 'name" name="other[' + b + '][area_name]" type="hidden" value="">' +
            '</div>' +
            '<a href="#myModal2" class="link area-edit" data-toggle="modal" onclick="fn(this)">编辑</a>' +
            '<input type="hidden" id="a' + b + 'id" name="other[' + b + '][area_id]" value="" >' +
            '<input type="hidden" id="a' + b + 'id1" name="other[' + b + '][is_default]" value="0" >' +
            '<input type="hidden" id="a' + b + 'id2" name="other[' + b + '][shipping_way]" value="' + shipping_way +
            '" >' +
            '</td>' +
            '<td><input type="text" name="other[' + b + '][first_num]" value="1" class="input-text"></td>' +
            '<td><input type="text" name="other[' + b + '][first_fee]" value="1" class="input-text"></td>' +
            '<td><input type="text" name="other[' + b + '][continue_num]" value="1" class="input-text"></td>' +
            '<td><input type="text" name="other[' + b + '][continue_fee]" value="1" class="input-text"></td>' +
            '<td><a class="link" onclick="removeDiv(this)">删除</a></td>' +
            '</tr>';

        $(data).parent().parent().find("table").append(kuaidi_anjian_tr);
    }

    var a = 0;
    var m = 0;
    //ajax获取区域列表
    $.ajax({
        type: "GET",
        url: "{:U('getArea')}",
        dataType: "json",
        success: function(data) {
            var html = '';
            $(data).each(function(k, v) {
                html +=
                    '<div class="area_wrapper"><div class="checkbox-wrapper"><input type="checkbox" lay-filter="checkAll" value="aa" title="' + v.large_area_name + '"></div><div class="child_area">';
                for(var i = 0; i < v.arr_child.length; i++) {
                    html += '<input type="checkbox" name="chk" lay-filter="chk" value="' + v.arr_child[i] + "-" +
                        v.arr_child_name[i] + '" lay-skin="primary" title="' + v.arr_child_name[i] + '"/>';
                }
                html += '</div></div>';
            })
            $('.hide_body').html(html);

        }
    });

    function removeDiv(e) {
        $(e).parent().parent().remove();
    }

    function checkAll(obj) {
        $(obj).parent('.checkbox-wrapper').siblings('.child_area').find('input').prop('checked', $(obj).prop('checked'));
        form.render();
    }

    function fn(e) {
        $(".modal-body").find("input").removeAttr("disabled");
        //m = $(e).parent().find('textarea').attr('id');
        m = $(e).parent().find('p').attr('id');
        /* 判断选中和禁用 */
        var xuanzhong_id = $(e).parent().find('input').eq(1).val();
        var quanbuyixuan_id = $(e).parent().parent().parent().find("input[name$='][area_id]']").map(function(index,
                                                                                                             elem) {
            if(($(elem).val()) != '') {
                return $(elem).val()
            }
        }).get().join(',');
        /* 禁用的地区*/
        var arr2 = new Array();
        arr2 = quanbuyixuan_id.split(',');
        $("input:checkbox[name='chk']").each(function() {
            var id = $(this).val().split('-')[0];
            for(i = 0; i < arr2.length; i++) {
                if(arr2[i] == id) {
                    $(this).attr("disabled", "disabled");
                    $(this).parent().siblings('.checkbox-wrapper').find('input').eq(0).prop("disabled", "disabled");
                }
            }
        })

        /* 选中的地区*/
        var arr = new Array();
        arr = xuanzhong_id.split(',');
        $("input:checkbox[name!='shipping_way[]']").each(function() {
            this.checked = false;
            var id = $(this).val().split('-')[0];
            for(i = 0; i < arr.length; i++) {
                if(arr[i] == id) {
                    this.checked = true;
                    $(this).removeAttr("disabled");
                }
            }
        })
        form.render();
    }

    function closeDiv() {
        text = $("input:checkbox[name='chk']:checked").map(function(index, elem) {
            return $(elem).val().split('-')[1]
        }).get().join(',');
        textId = $("input:checkbox[name='chk']:checked").map(function(index, elem) {
            return $(elem).val().split('-')[0]
        }).get().join(',');
        $('#' + m).text(text);
        $('#' + m + 'name').val(text);
        $('#' + m + 'id').val(textId);
    }

    /* 点击包邮的操作 */
    //    $("#is_free0").change(function() {
    //      $("#kuaidi,#price_way0,#price_way1,#price_way2,input[name='shipping_way[]']").removeAttr('disabled');
    //    });
    //    $("#is_free1").change(function() {
    //      if(this.checked == true) {
    //        alert("选择'卖家承担运费'后，所有区域的运费将无法设置！");
    //        //隐藏运费编辑区域
    //        $("#jifeifangshi_kuaidi,#jifeifangshi_ems,#jifeifangshi_pingyou").hide();
    //        //移除复选框单击事件
    //        $("#kuaidi,#price_way0,#price_way1,#price_way2,input[name='shipping_way[]']").prop('disabled',
    //          'disabled');
    //        $("#kuaidi,#ems,#pingyou").prop('checked', false);
    //        /* $("#kuaidi").unbind('click'); */
    //      }
    //
    //    })
    //地区三级联动
    //收获地址修改加载省城市地址
    function gsloadRegions(type, target, parent, sel) {
        $.get("{:U('get_city')}", {
            parent: parent
        }, function(result) {
            if(result && result.length > 0) {
                $("#" + target).empty();
                var temp = [];
                for(var i = 0; i < result.length; i++) {
                    if(i == 0) {
                        var txt = "";
                        if(type == 1) {
                            txt = "请选择省";
                        } else if(type == 2) {
                            txt = "请选择市";
                        } else if(type == 3) {
                            txt = "请选择区";
                        }
                        var d_item = $('<option></option>').val(0).text(txt);
                        $("#" + target).append(d_item);
                    }
                    var li_item = '<option value="' + result[i].region_id + '">' + result[i].region_name + '</option>';
                    if(result[i].region_id == sel) {
                        li_item.attr('selected', true);
                    }
                    temp.push(li_item);
                }
                $("#" + target).append(temp);
                form.render();
            }
        });
    }

    form.on('select(selCountries)', function(data) {
        gsloadRegions(1, 'selProvinces', data.value, 'province');
    })
    form.on('select(selProvinces)', function(data) {
        gsloadRegions(2, 'selCities', data.value, 'city');
    })
    form.on('select(selCities)', function(data) {
        gsloadRegions(3, 'selDistricts', data.value, 'area');
    })
    form.on('radio(postage)', function(data) {
        //      layer.alert("选择“卖家承担运费”后，所有区域的运费将无法设置！");
        layer.confirm("选择“卖家承担运费”后，所有区域的运费将无法设置！", function(index) {
            $('#price_way0').attr('disabled', 'disabled').removeAttr("checked");
            $('#price_way1').attr('disabled', 'disabled').removeAttr("checked");
            $('#price_way2').attr('disabled', 'disabled').removeAttr("checked");
            $('#kuaidi').attr('disabled', 'disabled').removeAttr('checked');
            $('#ems').attr('disabled', 'disabled').removeAttr('checked');
            $('#pingyou').attr('disabled', 'disabled').removeAttr('checked');
            $("#jifeifangshi_pingyou").empty();
            $("#jifeifangshi_ems").empty();
            $("#jifeifangshi_kuaidi").empty();
            form.render();
            layer.close(index);
        }, function(index) {
            $('#is_free0').click();
            layer.close(index);
            form.render();
            return false;
        })
    })
    form.on('radio(diyPostage)', function(data) {
        $('#price_way0').removeAttr('disabled').click();
        $('#price_way1').removeAttr('disabled');
        $('#price_way2').removeAttr('disabled');
        $('#kuaidi').removeAttr('disabled').attr('checked', 'checked');
        $('#ems').removeAttr('disabled');
        $('#pingyou').removeAttr('disabled');
        form.render();
        return false;
    })
    form.on('radio(payWay)', function(data) {
        layer.confirm('切换计价方式后，所设置当前模板的运输信息将被清空，确定继续吗？',function(index){
            $('#payways').find('.layui-input-block input[type=checkbox]').attr("price_way",data.value);
            checkid = data.value;
            $("#jifeifangshi_pingyou").empty();
            $("#jifeifangshi_ems").empty();
            $("#jifeifangshi_kuaidi").empty();
            $('#kuaidi').removeAttr('checked');
            $('#ems').removeAttr('checked');
            $('#pingyou').removeAttr('checked');
            form.render();
            layer.close(index);
        },function(index){
            $('#price_way'+checkid).click()
            form.render();
            layer.close(index);
            return false;
        })

    })
    form.on('checkbox(kuaidi)', function(data) {
        addShipping(this);
    })
    form.on('checkbox(ems)', function(data) {
        addShipping(this);
    })
    form.on('checkbox(pingyou)', function(data) {
        addShipping(this);
    })
    form.on('checkbox(checkAll)', function(data) {
        checkAll(this);
    })
    form.on('checkbox(chk)', function() {
        if(!this.checked) {
            $(this).parent('.child_area').siblings('.checkbox-wrapper').find('input').eq(0).removeAttr('checked');
            form.render();
        }
    })
</script>
</body>

</html>