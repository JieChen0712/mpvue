<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
        <title>添加收货地址</title>
        <include file="Public/header_v3" />
        <link rel="stylesheet" href="__PUBLIC__/Admin_v3/css/order_address.css" type="text/css" />
        <!--script start-->
        <script src="__PUBLIC__/Admin_v3/js/light7.min.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" src="__PUBLIC__/Admin_v3/js/light7-city-picker.min.js" charset="utf-8"></script>
        <!--script end-->
        <script>
            var return_url = "{$return_url}";
        </script>
    </head>

    <body>
        <div class="page">
            <section class="order-address">
                <div class="content">
                    <ul class="add-address">
                        <li><span>收货人:</span><input type="text" id="receiver" value="" required="required" /></li>
                        <li><span>联系电话:</span><input type="tel" id="phone" value="" required="required" pattern="^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$" /></li>
                        <li><span style="flex: 0 0 5.625rem;">所在地址:</span>
                            <include file="./App/Public/city_picker.html" re_province="" re_city="" re_county=""/>
                        </li>
                        <li><textarea name="address-detail" id="address" rows="2" cols="50" placeholder="请填写详细地址"></textarea></li>
                        <input type="hidden" id="default">
                        <input type="button" class="save" onclick="add(this)" value="保存" id="save" />
                    </ul>
                </div>
            </section>

        </div>
    </body>
    <script>
        var addressflag = false;

        function add(aim) {
            if(addressflag) {
                return
            }
            addressflag = true;
            $(aim).val('保存中...').css({
                backgroundColor: '#a0a0a0'
            });
            var odata = {
                name: $("#receiver").val(),
                phone: $("#phone").val(),
                province: $("#city-picker").val(),
                address: $("#address").val(),
                probably_address:$(".probably_address").val(),
                return_url: return_url,
            }
            $.post("__APP__/Admin/address/address_insert", odata, function(data) {
                if(data.status == '1') {
                    tusi(data.message);
                    setTimeout(function() {
                        if(return_url) {
                            window.location.href = return_url;
                        } else {
                            window.location.href = 'address_detail';
                        }
                    }, 2000);
                } else {
                    $(aim).val('保存').css({
                        backgroundColor: '#009CDA'
                    });
                    tusi(data.message);
                }
                setTimeout(function() {
                    addressflag = false;
                }, 2000);
            });
        }
    </script>

</html>