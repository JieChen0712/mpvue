<?php
	include(APP_PATH."/Class/jssdk.php");
		$jssdk = new JSSDK($app_id,$app_secret);
	    $signPackage = $jssdk->GetSignPackage();
?>
<!DOCTYPE html>
<html>
<head lang="en">
    <title>发货</title>
    <include file="Public/header"/>
    <script>var flag = "{$Think.session.ls}";</script>
    <script>var count =1;</script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>var arr=""; var down="";</script>
	<script>
		wx.config({
		appId: '<?php echo $signPackage["appId"];?>',
	    timestamp: <?php echo $signPackage["timestamp"];?>,
	    nonceStr: '<?php echo $signPackage["nonceStr"];?>',
	    signature: '<?php echo $signPackage["signature"];?>',
		    jsApiList: [
		      // 所有要调用的 API 都要加到这个列表中
		      "chooseImage",
		      "uploadImage"
		    ]
		  });
		  wx.ready(function () {
		    // 在这里调用 API
		  });
		 function imgchoose() {
			 wx.chooseImage({
				    count: 1, // 默认9
				    sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
				    sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
				    success: function (res) {
				        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
				        arr = localIds;
				        //var ob = document.getElementById('my');
				        //ob.setAttribute('src',localIds);
				    }
				});
		 }
	 function imgup() {
		 wx.uploadImage({
			    localId: arr[0], // 需要上传的图片的本地ID，由chooseImage接口获得
			    isShowProgressTips: 0, // 默认为1，显示进度提示
			    success: function (res) {
			        var serverId = res.serverId; // 返回图片的服务器端ID
			        down = serverId;
			        tusi(serverId);
			    }
			});

			
	 }
		 function imgdown() { 
			 tusi(down);
		 wx.downloadImage({
			    serverId: down, // 需要下载的图片的服务器端ID，由uploadImage接口获得
			    isShowProgressTips: 0, // 默认为1，显示进度提示
			    success: function (res) {
			        var localId = res.localId; // 返回图片下载后的本地ID
			        tusi(localId);
			    }
			});
		 }
    </script>
    <body style="background-color:#f5f5f5">
    <div style="margin-top:100px;">
      	<input type="button" value="选图" onclick="imgchoose();"/></br>
      	<input type="button" value="上传" onclick="imgup();"/>
      	<input type="button" value="下载" onclick="imgdown();"/>
      	</div>
      	<img id="my" src=""/>
    </body>
    </html>