<!DOCTYPE html>
<html>
    <head lang="en">
        <title>产品详情</title>
    <include file="Public/header_v2.1"/>
    <link rel="stylesheet" href="__PUBLIC__/Admin_v2/css/product-single.css">
    <link rel="stylesheet" href="__PUBLIC__/Admin_v2/css/amazeui.min.css">
    <script type="text/javascript" src="__PUBLIC__/Admin_v2/js/amazeui.min.js"></script>
</head>

<script>
    function checkIsInteger(str)
    {
        //如果为空，则通过校验
        if (str == "")
            return true;
        if (/^(\-?)(\d+)$/.test(str))
            return true;
        else
            return false;
    }
    var errordialog = function (c) {
        alert(c)
    }
//检验商品数量
    function checkCounts(id) {
        var Counts = $("#" + id).val();
        if (Counts == "") {
            errordialog("请填写数量!");
            return false;
        } else if (!checkIsInteger(Counts)) {
            errordialog("商品数量不是整数!");
            return false;
        } else if (Counts < 1) {
            errordialog("商品数量不能小于1!");
            return false;
        } else {
            return true;
        }
    }
    function addQty() {
        checkCounts('txtQty');
        var qty = parseInt($('#txtQty').val());
        $('#txtQty').val(qty + 1);
    }
    function subtractQty() {
        checkCounts('txtQty');
        var qty = parseInt($('#txtQty').val());
        if (qty <= 1) {
            errordialog("商品数量不能小于1");
            return;
        }
        $('#txtQty').val(qty - 1);
    }
</script>

<body>
    <header class="header">
        <p>产品详情</p>
        <a href="javascript:history.go(-1);" class="a"></a>
    </header>
    <div class="container">

        <ul class="am-slides" >
            <li style="">
                <img src="{$list.image}" style="width:100%;height:450px;padding:20px;">
            </li>
        </ul>

        <div class="gray-panel">
            <div class="paoduct-title-panel">
                <h1 class="product-h1">{$list.name}</h1>
                <p><span class="bold">价格：</span><span class="red2" id='price'>￥{$list.price}</span>
            </div>.
            
            <script>
                var skus = <php>echo json_encode($skus)</php>;
                var has_property = {$has_property};
            </script>
            <script src="__PUBLIC__/Admin_v2/js/sku.js"></script>
            <div class="my-search-title-panel properties">
                <notempty name="properties">
                <volist name="properties" id="property">
                    <p class="my-search-titp-p am-text-sm bold property-name" data-index="{$i}" data-msg='{$property.name}'>{$property.name}</p>
                    <p class="size-p item_property_detail">
                    <volist name="property.values" id="value">
                        <span class="select_property" id="sku_{$property.pid}_{$value.vid}" data-pid="{$property.pid}"
                              data-vid="{$value.vid}" data-sku="{$property.pid}:{$value.vid}">{$value.value}</span>
                    </volist>
                </p>
                    <hr data-am-widget="divider" style="" class="am-divider-default am-margin-bottom-sm"/>
                </volist>
                </notempty>
                <input type="hidden" value="" id='sku_id' name="sku_id"/>
                <p class="my-search-titp-p am-text-sm bold" id="p">数量</p>
                
                
                <div style="overflow:hidden">
                    <form class="am-form-inline" role="form">
                        <button type="button" class="am-btn am-btn-default" style="float:left" onClick="subtractQty();" ><i class="am-icon-minus"></i></button>
                        <input type="number" name="txtQty" id="txtQty" class="am-form-field txt-qty am-text-center am-text-sm" value="1" style=" width:120px; margin-right:0px; height:37px; display:inline; float:left; font-size:24px;">
                        <button type="button" class="am-btn am-btn-default" style="float:left" onClick="addQty();"><i class="am-icon-plus"></i></button>
                        <!--<li class="am-text-center">库存：0件</li>-->
                    </form>
                    
                <div style="float:right; width:auto;font-size: 24px;">&nbsp;&nbsp;库存：<span id="quantity" data-value="{$list.quantity}">{$list.quantity}</span>件</div>
                </div>
                
                
                <hr data-am-widget="divider" style="" class="am-divider-default am-margin-bottom-sm"/>
                
            </div>
        </div>
        <!-- 商品详情 -->

        <div style="margin-bottom: 70px;" data-am-widget="tabs" class="am-tabs am-tabs-d2">
            <ul class="am-tabs-nav am-cf">
                <li class="am-active">
                    <a href="[data-tab-panel-0]">商品详情</a>
                </li>
            </ul>
            <div class="am-tabs-bd">
                <div data-tab-panel-0 class="am-tab-panel am-active">
                    {$list.disc}
                </div>  
            </div>
        </div>
        
            
        <div class="am-g">
            <!--<button type="button" onclick="return add_shopping_cart();" class="am-btn am-btn-success am-radius" style="font-size: 25px;">加入购物车</button>-->
            <button onclick="return product_buy();" type="button" class="am-btn am-btn-danger am-radius" style="font-size: 25px; width: 100%">立即购买</button>
        </div>
        
    </div>

    <script>
        //直接下单购买
        function product_buy(){
            //商品属性/库存代码
            if  (!check_property()) {
                return false;
            }
            if (!check_quantity()) {
                return false;
            }
            var sku_id = $('#sku_id').val();
            var url = '__URL__/product_buy?sku_id='+sku_id+'&temp_id={$list.id}';
            var num = $("#txtQty").val();

            url = url + '&num='+num;

            window.location=url;
        }
        //添加产品
        function add_shopping_cart(){
            //商品属性/库存代码
            if  (!check_property()) {
                return false;
            }
            if (!check_quantity()) {
                return false;
            }
            var sku_id = $('#sku_id').val();
            var num = $("#txtQty").val();
            var tid = '{$list.id}';
            
            if( tid == '' ){
                tusi('找不到该商品！');
                return false;
            }
            
            if( num <= 0 || num =='' || num==null ){
                tusi('商品数量不能少于1！');
                return false;
            }
            
            $.post("__APP__/Admin/product/add_shopping_cart", {tid:tid,num:num,sku_id:sku_id}, function (data) {
                if (data.code == 1) {
                    tusi(data.msg);
                } else {
                    tusi(data.msg);
                }
            });
            
        }//end func add_shopping_cart
        
        
//        $(document).ready(function (e) {
//            $("#sizep span").click(function () {
//                $("#sizep span").removeClass('click');
//                $(this).addClass('click');
//                var s = $(this).attr('data-size');
//                $("#size").val(s);
//            });
//            $("#colorp span").click(function () {
//                $("#colorp span").removeClass('click');
//                $(this).addClass('click');
//                var s = $(this).attr('data-color');
//                $("#color").val(s);
//            });
//
//        });
    </script>
</body>
</html>