<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head lang="en">
        <title>在线充值</title>
        <include file="Public/header_v2"/>
        <link rel="stylesheet" href="__PUBLIC__/Admin_v2/css/order.css">
        <style>
            .order-detail p {
                font-size: 30px;
                /*line-height: 70px;*/
            }
        </style>
      
        <script>
            var param = '<?php echo $jsApiParameters;?>';
        </script>
    </head>
<body>
     <header class="header">
        <a href="javascript:history.go(-1);" class="a"></a>
        <p>在线充值</p>
        <!--dd-->
    </header>
    <div class="order-section">
        <div class="order-content">
            <div class="order-detail">
                <p>商品名称：资金充值</p>
                <p>订单金额：￥{$apply_money_info.apply_money}</p>
                <p>订单日期：{$apply_money_info.created|date="Y-m-d H:i",###}</p>
            </div>
        </div>
    </div>
    <div class="order-section shouhuo_box1">
        <div class="order-content" style="width:100%" onclick="callpay(param)">
            <p class="order-num" style="text-align: center;color:#ffffff;background: green;font-size: 30px;">微信支付</p>
        </div>
    </div>
    
    <script type="text/javascript">
        //跳转地址
        var return_url = "{$return_url}";

        //调用微信JS api 支付
        function jsApiCall(data)
        {
            WeixinJSBridge.invoke(
                'getBrandWCPayRequest',{
                    "appId":data.appId,
                    "nonceStr":data.nonceStr,
                    "package":data.package,
                    "prepay_id":data.prepay_id,
                    "signType":data.signType,
                    "timeStamp":data.timeStamp,
                    "paySign":data.paySign,
                },
                function(res){
                    if(res.err_msg == "get_brand_wcpay_request:ok" ) {
                        if(return_url != '' || return_url != null || return_url != undefined){
                            window.location.href = return_url;
                        }else{
                            window.location.href = '__APP__/admin/user/assets';
                        }
                    }
//                    WeixinJSBridge.log(res.err_msg);
//                    alert(res.err_code+res.err_desc+res.err_msg);
                }
            );
        }

        function callpay(param)
        {
            var data = $.parseJSON(param);
            if (typeof WeixinJSBridge == "undefined"){
                if( document.addEventListener ){
                    document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
                }else if (document.attachEvent){
                    document.attachEvent('WeixinJSBridgeReady', jsApiCall); 
                    document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
                }
            }else{
                jsApiCall(data);
            }
        }
    </script>
</body>
</html>
