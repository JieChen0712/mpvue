<!DOCTYPE html>
<html>

    <head lang="en">
        <include file="Public/header_v2" />
        <link rel="stylesheet" href="__PUBLIC__/Admin_v2/css/order.css">
        <title>我的活动订单</title>

        <style>
            body {
                background: url(__PUBLIC__/Admin_v2/images/bg.jpg) #fbfbfb no-repeat;
                background-color: #fbfbfb;
                background-size: cover;
            }
            
            .tel_title {
                background: transparent;
            }
            
            .mask1 {
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                position: fixed;
                top: 0;
                z-index: 10;
                text-align: center;
                padding-top: 360px;
                display: none;
            }
        </style>
    </head>

    <body>
        <div class="mask1"><img src="__PUBLIC__/images/yes1.png" alt=""></div>

        <header class="header">
            <a href="javascript:history.go(-1);" class="a"></a>
            <p>我的活动订单</p>
        </header>

        <section id="section1">
            <volist name="order" id="vv1" key="k">
                <div class="order-section">
                    <div class="order-content">
                        <div class="order-num"><span class="num">{$k}</span>订单号：{$vv1.order_num} <span class="order-status">{$status_name.$vv1[status]}</span></div>
                        <a href="{:U(GROUP_NAME.'/activityorder/detail?order_num='.$vv1[order_num])}">
                            <div class="order-detail">
                                <p>收货人：{$vv1.s_name}</p>
                                <p>手机号码：{$vv1.s_phone}</p>
                                <p>商品名称：{$vv1.product_name}</p>
                                <p>商品数量：{$vv1.total_num}</p>
                                <p>订单日期：{$vv1.time|toDate=###}</p>
                                <p>订单状态：
                                    <eq name="vv1.status" value="0">临时订单</eq>
                                    <eq name="vv1.status" value="1">未支付</eq>
                                    <eq name="vv1.status" value="2">未发货</eq>
                                    <eq name="vv1.status" value="3">已发货</eq>
                                    <eq name="vv1.status" value="4">已取消</eq>
                                    <eq name="vv1.status" value="5">已收货</eq>
                                </p>
                                <p class="go"><img src="__PUBLIC__/Admin_v2/images/icon-go.png" alt=""></p>
                            </div>
                        </a>
                        <div class="order-money">订单金额：<span class="red">￥{$vv1.total_price}</span>
                            <eq name="vv1.status" value="1">
                                <eq name="open_wxpay" value="1">
                                    <p style="float:right;" class="cancel-order red border-red" onclick="pay({$vv1.order_num})">去支付</p>
                                </eq>
                                <p style="float:right;" class="cancel-order red border-red" onclick="cancle({$vv1.order_num})">取消订单</p>
                            </eq>
                        </div>
                    </div>
                </div>
            </volist>
        </section>
        <script>
            function pay(order_num) {
                window.location.href = '__APP__/admin/wxpay/pay?order_num=' + order_num;
            }

            function cancle(order_num) {
                if(!confirm('确定取消该订单吗？')) {
                    return false;
                }
                $.post('__APP__/admin/activityorder/cancle', {
                    'order_num': order_num
                }, function(data) {
                    if(data) {
                        tusi('取消订单成功');
                        setTimeout(function() {
                            window.location.href = changeURLArg(window.location.href, "reloadtime", new Date().valueOf());
                        }, 2000);
                    } else {
                        tusi('取消订单失败');
                    }
                });
            }
            //设置url参
            function changeURLArg(url, arg, arg_val) {
                var pattern = arg + '=([^&]*)';
                var replaceText = arg + '=' + arg_val;
                if(url.match(pattern)) {
                    var tmp = '/(' + arg + '=)([^&]*)/gi';
                    tmp = url.replace(eval(tmp), replaceText);
                    return tmp;
                } else {
                    if(url.match('[\?]')) {
                        return url + '&' + replaceText;
                    } else {
                        return url + '?' + replaceText;
                    }
                }
                return url + '\n' + arg + '\n' + arg_val;
            }
        </script>
    </body>

</html>